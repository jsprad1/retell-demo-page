<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Church Receptionist Demo</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    .demo-widget {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 480px;
      margin: 0 auto;
      padding: 24px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    }

    .demo-widget h2 {
      font-size: 1.5rem;
      color: #1e3a5f;
      margin-bottom: 8px;
      text-align: center;
    }

    .demo-widget .subtitle {
      color: #666;
      text-align: center;
      margin-bottom: 24px;
      font-size: 0.95rem;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-weight: 500;
      color: #333;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }

    .form-group input {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #1e3a5f;
      box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
    }

    .form-group input::placeholder {
      color: #aaa;
    }

    .required::after {
      content: " *";
      color: #e74c3c;
    }

    .submit-btn {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(135deg, #1e3a5f, #2d5a87);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 8px;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
    }

    .submit-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    /* Progress Section */
    .progress-section {
      display: none;
      text-align: center;
      padding: 32px 16px;
    }

    .progress-section.active {
      display: block;
    }

    .progress-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid #e0e0e0;
      border-top-color: #1e3a5f;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 24px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .progress-steps {
      text-align: left;
      max-width: 280px;
      margin: 0 auto;
    }

    .progress-step {
      display: flex;
      align-items: center;
      padding: 10px 0;
      color: #999;
      font-size: 0.95rem;
      transition: color 0.3s;
    }

    .progress-step.active {
      color: #1e3a5f;
      font-weight: 500;
    }

    .progress-step.completed {
      color: #27ae60;
    }

    .progress-step .step-icon {
      width: 24px;
      height: 24px;
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .progress-step .step-icon::before {
      content: "○";
      font-size: 1.2rem;
    }

    .progress-step.active .step-icon::before {
      content: "◉";
      color: #1e3a5f;
    }

    .progress-step.completed .step-icon::before {
      content: "✓";
      color: #27ae60;
      font-weight: bold;
    }

    /* Success Section */
    .success-section {
      display: none;
      text-align: center;
      padding: 24px 16px;
    }

    .success-section.active {
      display: block;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 2.5rem;
      color: white;
    }

    .success-section h3 {
      color: #1e3a5f;
      margin-bottom: 8px;
      font-size: 1.4rem;
    }

    .success-section p {
      color: #666;
      margin-bottom: 24px;
    }

    .call-btn {
      width: 100%;
      padding: 16px 24px;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      border: none;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
    }

    .call-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(39, 174, 96, 0.4);
    }

    .call-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .call-btn svg {
      width: 24px;
      height: 24px;
    }

    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 0.9rem;
      display: none;
    }

    .error-message.active {
      display: block;
    }

    /* Hide sections */
    .form-section {
      display: block;
    }

    .form-section.hidden {
      display: none;
    }

    /* Calling state */
    .calling-section {
      display: none;
      text-align: center;
      padding: 32px 16px;
    }

    .calling-section.active {
      display: block;
    }

    .calling-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    .calling-icon svg {
      width: 40px;
      height: 40px;
      color: white;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .calling-section h3 {
      color: #27ae60;
      margin-bottom: 8px;
    }

    .calling-section p {
      color: #666;
    }
  </style>
</head>
<body style="padding: 40px; background: #f5f5f5;">

  <div class="demo-widget" id="demoWidget">
    <!-- Form Section -->
    <div class="form-section" id="formSection">
      <h2>Try Your AI Receptionist</h2>
      <p class="subtitle">Get a personalized demo in under 30 seconds!</p>

      <div class="error-message" id="errorMessage"></div>

      <form id="demoForm">
        <div class="form-group">
          <label class="required">Church/Business Name</label>
          <input type="text" name="businessName" placeholder="Grace Community Church" required>
        </div>

        <div class="form-group">
          <label class="required">Website URL</label>
          <input type="url" name="website" placeholder="https://yourchurch.com" required>
        </div>

        <div class="form-group">
          <label class="required">Your Name</label>
          <input type="text" name="firstName" placeholder="John" required>
        </div>

        <div class="form-group">
          <label class="required">Email</label>
          <input type="email" name="email" placeholder="john@yourchurch.com" required>
        </div>

        <div class="form-group">
          <label class="required">Phone Number</label>
          <input type="tel" name="phone" placeholder="(555) 123-4567" required>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          Build My AI Demo
        </button>
      </form>
    </div>

    <!-- Progress Section -->
    <div class="progress-section" id="progressSection">
      <div class="progress-spinner"></div>
      <h3 style="color: #1e3a5f; margin-bottom: 24px;">Building Your AI Receptionist...</h3>

      <div class="progress-steps">
        <div class="progress-step" id="step1">
          <span class="step-icon"></span>
          <span>Analyzing your website</span>
        </div>
        <div class="progress-step" id="step2">
          <span class="step-icon"></span>
          <span>Training AI on your content</span>
        </div>
        <div class="progress-step" id="step3">
          <span class="step-icon"></span>
          <span>Configuring voice personality</span>
        </div>
        <div class="progress-step" id="step4">
          <span class="step-icon"></span>
          <span>Finalizing your demo</span>
        </div>
      </div>
    </div>

    <!-- Success Section -->
    <div class="success-section" id="successSection">
      <div class="success-icon">✓</div>
      <h3>Your AI Receptionist is Ready!</h3>
      <p id="successMessage">Hi <span id="userName">there</span>, your demo for <strong id="businessNameDisplay"></strong> is ready to try!</p>

      <button class="call-btn" id="phoneCallBtn">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
        </svg>
        Call Me Now
      </button>
    </div>

    <!-- Calling Section -->
    <div class="calling-section" id="callingSection">
      <div class="calling-icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
        </svg>
      </div>
      <h3>Calling You Now!</h3>
      <p>Answer your phone to talk to your AI receptionist.</p>
      <p style="margin-top: 12px; font-size: 0.9rem; color: #888;">Call from: (772) 205-3109</p>
    </div>
  </div>

  <script>
    // ============================================
    // CONFIGURATION
    // ============================================
    const CONFIG = {
      webhookUrl: 'https://n8n.srv872189.hstgr.cloud/webhook/church-demo'
    };
    // ============================================

    let currentAgentId = null;
    let userPhoneNumber = null;

    // Form submission
    document.getElementById('demoForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());

      // Store phone number for later
      userPhoneNumber = data.phone;

      // Hide form, show progress
      document.getElementById('formSection').classList.add('hidden');
      document.getElementById('progressSection').classList.add('active');

      // Start progress animation (runs in parallel with API call)
      const progressPromise = animateProgress();

      try {
        // Call webhook to create agent
        const response = await fetch(CONFIG.webhookUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        // Wait for progress animation to complete
        await progressPromise;

        if (result.success && result.agent_id) {
          currentAgentId = result.agent_id;

          // Update success section
          document.getElementById('userName').textContent = result.first_name || data.firstName;
          document.getElementById('businessNameDisplay').textContent = result.business_name || data.businessName;

          // Show success
          document.getElementById('progressSection').classList.remove('active');
          document.getElementById('successSection').classList.add('active');
        } else {
          throw new Error(result.error || 'Failed to create demo');
        }
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('progressSection').classList.remove('active');
        document.getElementById('formSection').classList.remove('hidden');
        document.getElementById('errorMessage').textContent = error.message || 'Something went wrong. Please try again.';
        document.getElementById('errorMessage').classList.add('active');
      }
    });

    // Animate progress steps
    async function animateProgress() {
      const steps = ['step1', 'step2', 'step3', 'step4'];
      const delays = [3000, 4000, 3000, 2000];

      for (let i = 0; i < steps.length; i++) {
        document.getElementById(steps[i]).classList.add('active');
        await sleep(delays[i]);
        document.getElementById(steps[i]).classList.remove('active');
        document.getElementById(steps[i]).classList.add('completed');
      }
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Phone call button - uses the phone from the form
    document.getElementById('phoneCallBtn').addEventListener('click', async () => {
      if (!userPhoneNumber) {
        alert('No phone number provided');
        return;
      }

      // Format phone number
      let formattedPhone = userPhoneNumber.replace(/\D/g, '');
      if (formattedPhone.length === 10) {
        formattedPhone = '+1' + formattedPhone;
      } else if (!formattedPhone.startsWith('+')) {
        formattedPhone = '+' + formattedPhone;
      }

      const btn = document.getElementById('phoneCallBtn');

      try {
        btn.disabled = true;
        btn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width:24px;height:24px;animation:spin 1s linear infinite"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Calling...';

        const response = await fetch('/api/call', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            agent_id: currentAgentId,
            phone_number: formattedPhone
          })
        });

        const result = await response.json();

        if (response.ok) {
          // Show calling state
          document.getElementById('successSection').classList.remove('active');
          document.getElementById('callingSection').classList.add('active');
        } else {
          throw new Error(result.message || 'Failed to initiate call');
        }
      } catch (error) {
        console.error('Phone call error:', error);
        alert('Failed to initiate call: ' + error.message);
        btn.disabled = false;
        btn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width:24px;height:24px"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg> Call Me Now';
      }
    });
  </script>

</body>
</html>
